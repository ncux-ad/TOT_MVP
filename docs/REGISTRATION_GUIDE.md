# üìù –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –¢–û–¢ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ç—ã—Ä–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **–ü–∞—Ü–∏–µ–Ω—Ç—ã** (patient) - –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **–í—Ä–∞—á–∏** (doctor) - –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
- **–ö–ª–∏–Ω–∏–∫–∏** (clinic) - –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã** (admin) - —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

## üîó API Endpoints

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```
POST /auth/register
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```
POST /auth/login
```

## üìã –ü–æ–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|------|-----|----------|-----------|
| `email` | string | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –í–∞–ª–∏–¥–Ω—ã–π email —Ñ–æ—Ä–º–∞—Ç |
| `password` | string | –ü–∞—Ä–æ–ª—å | –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤ |
| `first_name` | string | –ò–º—è | 2-50 —Å–∏–º–≤–æ–ª–æ–≤ |
| `last_name` | string | –§–∞–º–∏–ª–∏—è | 2-50 —Å–∏–º–≤–æ–ª–æ–≤ |
| `role` | string | –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | patient, doctor, clinic, admin |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|------|-----|----------|-----------|
| `phone` | string | –¢–µ–ª–µ—Ñ–æ–Ω | +7 –∏–ª–∏ 8, –º–∏–Ω–∏–º—É–º 10 —Ü–∏—Ñ—Ä |

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤—Ä–∞—á–µ–π

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|------|-----|----------|-----------|
| `specialization` | string | –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | –î–æ 100 —Å–∏–º–≤–æ–ª–æ–≤ |
| `license_number` | string | –ù–æ–º–µ—Ä –ª–∏—Ü–µ–Ω–∑–∏–∏ | –î–æ 50 —Å–∏–º–≤–æ–ª–æ–≤ |
| `experience_years` | integer | –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã | 0-50 –ª–µ—Ç |

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–ª–∏–Ω–∏–∫

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|------|-----|----------|-----------|
| `clinic_name` | string | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∏ | –î–æ 200 —Å–∏–º–≤–æ–ª–æ–≤ |
| `clinic_address` | string | –ê–¥—Ä–µ—Å –∫–ª–∏–Ω–∏–∫–∏ | –î–æ 500 —Å–∏–º–≤–æ–ª–æ–≤ |
| `clinic_license` | string | –õ–∏—Ü–µ–Ω–∑–∏—è –∫–ª–∏–Ω–∏–∫–∏ | –î–æ 50 —Å–∏–º–≤–æ–ª–æ–≤ |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞

```json
{
  "email": "patient@example.com",
  "password": "securepass123",
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "role": "patient",
  "phone": "+7 (999) 123-45-67"
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Ä–∞—á–∞

```json
{
  "email": "doctor@example.com",
  "password": "doctorpass123",
  "first_name": "–î–æ–∫—Ç–æ—Ä",
  "last_name": "–ü–µ—Ç—Ä–æ–≤",
  "role": "doctor",
  "specialization": "–¢–µ—Ä–∞–ø–µ–≤—Ç",
  "license_number": "DOC123456",
  "experience_years": 5
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–Ω–∏–∫–∏

```json
{
  "email": "clinic@example.com",
  "password": "clinicpass123",
  "first_name": "–ö–ª–∏–Ω–∏–∫–∞",
  "last_name": "–ó–¥–æ—Ä–æ–≤—å–µ",
  "role": "clinic",
  "clinic_name": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä '–ó–¥–æ—Ä–æ–≤—å–µ'",
  "clinic_address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 1",
  "clinic_license": "CLINIC123456"
}
```

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 86400,
  "user": {
    "id": "uuid-string",
    "email": "user@example.com",
    "phone": "+7 (999) 123-45-67",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "role": "patient",
    "is_active": true,
    "is_verified": false,
    "specialization": null,
    "license_number": null,
    "experience_years": null,
    "clinic_name": null,
    "clinic_address": null,
    "clinic_license": null,
    "created_at": "2025-08-06T20:58:40.600197",
    "updated_at": "2025-08-06T20:58:40.600197"
  }
}
```

## ‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ù–µ–≤–µ—Ä–Ω—ã–π email
```json
{
  "detail": [
    {
      "type": "value_error",
      "loc": ["body", "email"],
      "msg": "value is not a valid email address: An email address must have an @-sign.",
      "input": "invalid-email"
    }
  ]
}
```

### –ö–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å
```json
{
  "detail": [
    {
      "type": "string_too_short",
      "loc": ["body", "password"],
      "msg": "String should have at least 6 characters",
      "input": "123",
      "ctx": {"min_length": 6}
    }
  ]
}
```

### –ù–µ–≤–µ—Ä–Ω–∞—è —Ä–æ–ª—å
```json
{
  "detail": [
    {
      "type": "string_pattern_mismatch",
      "loc": ["body", "role"],
      "msg": "String should match pattern '^(patient|doctor|clinic|admin)$'",
      "input": "invalid"
    }
  ]
}
```

### –î—É–±–ª–∏–∫–∞—Ç email
```json
{
  "detail": "User with this email or phone already exists"
}
```

## üîß Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```typescript
const registerUser = async (userData: RegisterData) => {
  try {
    const response = await api.post('/auth/register', userData);
    const { access_token, user } = response.data;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
    localStorage.setItem('token', access_token);
    api.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;
    
    return user;
  } catch (error) {
    if (error.response?.data?.detail) {
      throw new Error(error.response.data.detail);
    }
    throw new Error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
  }
};
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

```typescript
const validateRegistration = (data: RegisterForm) => {
  const errors: any = {};
  
  // Email
  if (!data.email) {
    errors.email = 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
  } else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(data.email)) {
    errors.email = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
  }
  
  // –ü–∞—Ä–æ–ª—å
  if (!data.password) {
    errors.password = '–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
  } else if (data.password.length < 6) {
    errors.password = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
  }
  
  // –ò–º—è
  if (!data.first_name) {
    errors.first_name = '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
  } else if (data.first_name.length < 2) {
    errors.first_name = '–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞';
  }
  
  // –§–∞–º–∏–ª–∏—è
  if (!data.last_name) {
    errors.last_name = '–§–∞–º–∏–ª–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞';
  } else if (data.last_name.length < 2) {
    errors.last_name = '–§–∞–º–∏–ª–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞';
  }
  
  // –¢–µ–ª–µ—Ñ–æ–Ω
  if (data.phone && !data.phone.match(/^(\+7|8)/)) {
    errors.phone = '–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å +7 –∏–ª–∏ 8';
  }
  
  return errors;
};
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```bash
python test_registration_improved.py
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
3. **–î—É–±–ª–∏–∫–∞—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email
4. **–í—Ö–æ–¥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é bcrypt
- –°–æ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### JWT —Ç–æ–∫–µ–Ω—ã
- –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 24 —á–∞—Å–∞
- –ê–ª–≥–æ—Ä–∏—Ç–º: HS256

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ ORM
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–æ–ª–∏**: 4 (patient, doctor, clinic, admin)
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π**: 5 (email, password, first_name, last_name, role)
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π**: 8 (phone, specialization, license_number, etc.)
- **–í–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤**: 6 (email, password, name, role, phone, experience)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 06.08.2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
