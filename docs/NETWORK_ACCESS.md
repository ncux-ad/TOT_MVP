# üåê –î–æ—Å—Ç—É–ø –∫ TOT API –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API —Å–∏—Å—Ç–µ–º—ã –¢–û–¢ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üîß –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
- **IP –∞–¥—Ä–µ—Å**: `192.168.1.107`
- **–°–µ—Ç—å**: `192.168.1.0/24`
- **–®–ª—é–∑**: `192.168.1.100`

### –ü–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤
| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | URL |
|--------|------|-----|
| API Gateway | 8000 | `http://192.168.1.107:8000` |
| User Service | 8001 | `http://192.168.1.107:8001` |
| Profile Service | 8002 | `http://192.168.1.107:8002` |
| Payment Service | 8005 | `http://192.168.1.107:8005` |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```bash
# API Gateway
curl http://192.168.1.107:8000/health

# User Service
curl http://192.168.1.107:8001/health

# Profile Service
curl http://192.168.1.107:8002/health

# Payment Service
curl http://192.168.1.107:8005/health
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://192.168.1.107:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "role": "patient"
  }'

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
curl -X POST http://192.168.1.107:8000/payments/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "amount": 1000.0,
    "currency": "RUB",
    "payment_method": "yookassa",
    "description": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞"
  }'
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CORS
API Gateway –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏:
- `http://localhost:3000` (Patient App)
- `http://localhost:3001` (Doctor App)
- `http://localhost:3002` (Clinic Web)
- `http://localhost:3003` (Admin Panel)

### Trusted Hosts
–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ö–æ—Å—Ç—ã –≤–º–µ—Å—Ç–æ `"*"`.

## üåç –î–æ—Å—Ç—É–ø –∏–∑ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –í —Ç–æ–π –∂–µ —Å–µ—Ç–∏
–õ—é–±–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —Å–µ—Ç–∏ `192.168.1.0/24` –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API:

```bash
# –° –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
curl http://192.168.1.107:8000/health

# –° –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
curl http://192.168.1.107:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"123","first_name":"Test","last_name":"User"}'
```

### –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- `http://192.168.1.107:8000/docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API Gateway
- `http://192.168.1.107:8001/docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è User Service
- `http://192.168.1.107:8002/docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Profile Service
- `http://192.168.1.107:8005/docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Payment Service

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –î–ª—è API Gateway
$env:API_GATEWAY_HOST="0.0.0.0"
$env:API_GATEWAY_PORT="8000"

# –î–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
$env:DATABASE_URL="sqlite:///./tot_mvp.db"
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```powershell
# API Gateway
$env:DATABASE_URL="sqlite:///./tot_mvp.db"; $env:API_GATEWAY_HOST="0.0.0.0"; python backend/api-gateway/main.py

# User Service
$env:DATABASE_URL="sqlite:///./tot_mvp.db"; python backend/user-service/main.py

# Profile Service
$env:DATABASE_URL="sqlite:///./tot_mvp.db"; python backend/profile-service/main.py

# Payment Service
$env:DATABASE_URL="sqlite:///./tot_mvp.db"; python backend/payment-service/main.py
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

#### –†–µ—à–µ–Ω–∏–µ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ Windows
```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
.\scripts\setup-firewall.ps1
```

#### –†–µ—à–µ–Ω–∏–µ 2: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞
```powershell
# –í PowerShell –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
netsh advfirewall set allprofiles state off
```

#### –†–µ—à–µ–Ω–∏–µ 3: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ "–ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä –ó–∞—â–∏—Ç–Ω–∏–∫–∞ Windows"
2. –í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"
3. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 8000, 8001, 8002, 8005

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
Get-Process python

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
netstat -an | findstr :8000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å
ipconfig

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
ping 192.168.1.107
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IP –∞–¥—Ä–µ—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `ipconfig`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä Windows
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã —Å `host="0.0.0.0"`

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏
–î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ `backend/api-gateway/main.py`:
```python
allow_origins=os.getenv("CORS_ORIGINS", "http://192.168.1.107:3000,http://localhost:3000").split(",")
```

## üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Android
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Termux –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
curl http://192.168.1.107:8000/health
```

### iOS
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π HTTP –∫–ª–∏–µ–Ω—Ç
GET http://192.168.1.107:8000/health
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞

–ï—Å–ª–∏ IP –∞–¥—Ä–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è:

1. –£–∑–Ω–∞–π—Ç–µ –Ω–æ–≤—ã–π IP:
```bash
ipconfig
```

2. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
4. –û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
$services = @(8000, 8001, 8002, 8005)
foreach ($port in $services) {
    $response = curl http://192.168.1.107:$port/health -ErrorAction SilentlyContinue
    Write-Host "Port $port`: $response"
}
```

### –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS** - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** - –¥–ª—è –∑–∞—â–∏—Ç—ã API
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker** - –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. 