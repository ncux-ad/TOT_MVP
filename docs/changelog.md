# Changelog

## [03-08-2025] - Полная перезагрузка админ-панели и создание правил проекта

### Добавлено
- **Новая админ-панель с нуля**: Создана полностью новая админ-панель с чистой архитектурой
- **Правила проекта**: Создан документ `PROJECT_RULES_AND_LESSONS.md` с извлечёнными уроками
- **Пошаговый подход**: Внедрён принцип "сначала работает, потом красиво"
- **Детальное логирование**: Добавлены подробные console.log для отладки React компонентов
- **Управление токенами**: Реализовано правильное сохранение и использование JWT токенов

### Исправлено
- **React компоненты**: Устранены проблемы с рендерингом через упрощение архитектуры
- **Аутентификация**: Правильная обработка токенов в localStorage и axios headers
- **Windows совместимость**: Исправлены команды npm start для Windows (`set PORT=3003 && react-scripts start`)
- **Зависимости**: Установлена правильная версия react-scripts после поломки `npm audit fix --force`
- **Proxy настройки**: Упрощены до строкового формата для совместимости

### Удалено
- **Старая админ-панель**: Полностью удалена сломанная версия
- **Сложные конструкции**: Убраны IIFE и другие усложнения из JSX

### Уроки
- **НИКОГДА** не использовать `npm audit fix --force` - ломает react-scripts
- **ВСЕГДА** начинать с простейшего рабочего компонента
- **ВСЕГДА** проверять рендеринг компонента перед отладкой логики
- **ВСЕГДА** логировать каждый этап выполнения
- При 403 ошибках - проверять токены аутентификации

## [03-08-2025] - Исправление аутентификации и запуска приложений

### Исправлено
- **Аутентификация в Patient App**: Исправлена обработка ответа API Gateway, который оборачивает данные в объект с `data`
- **Аутентификация в Admin Panel**: Исправлена обработка ответа API Gateway для админ-панели
- **Отображение пользователей в Admin Panel**: Исправлена обработка ответа API Gateway для списка пользователей
- **API Gateway токены**: Исправлена передача токенов между API Gateway и User Service
- **SQLAlchemy предупреждения**: Обновлены импорты для совместимости с SQLAlchemy 2.0
- **datetime предупреждения**: Заменены устаревшие `datetime.utcnow()` на `datetime.now()`
- **Настройки прокси**: Исправлены настройки proxy в package.json для Patient App и Admin Panel
- **Скрипты запуска**: Удалены неработающие .cmd и .bat файлы, оставлены только рабочие .ps1 скрипты

### Добавлено
- **Демо пользователи**: Созданы тестовые аккаунты для всех ролей
- **Тестирование API**: Добавлены тесты для проверки аутентификации

### Технические детали
- API Gateway возвращает ответ в формате: `{"status_code": 200, "data": {...}}`
- Frontend теперь корректно обрабатывает этот формат через `response.data.data || response.data`
- Все сервисы запускаются через отдельные скрипты: `start-backend-fixed.ps1`, `start-patient-app.ps1`, `start-admin-panel.ps1`

### Демо аккаунты
- **Patient App**: `patient@example.com` / `password123`
- **Admin Panel**: `admin@tot.ru` / `admin123`
- **Doctor App**: `doctor@example.com` / `doctor123`

## [Предыдущие изменения]
- Инициализация проекта ТОТ MVP
- Создание микросервисной архитектуры
- Разработка frontend приложений 